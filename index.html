<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.jsdelivr.net/npm/source-map@0.7.3/dist/source-map.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/terser/dist/bundle.min.js"></script>
    <title>YT-Membership-exporter</title>
</head>
<body>

<script>
    const get_compressed_code = async url => {
        return await fetch(url)
            .then(res => {
                return res.text()
            })
            .then(async code => {
                const result = await Terser.minify(code, {
                    output: {comments: /APP_VERSION/}
                })
                return result.code
            })
    }
    function get_url() {
        const base_url = 'https://raw.githubusercontent.com/oz0820/YT-Membership-exporter/'
        const urlParses = new URLSearchParams(location.search)
        const hash = urlParses.get('hash') ? urlParses.get('hash') : 'main'
        const file_name = urlParses.get('fileName') ? urlParses.get('fileName') : 'YT-Membership-exporter.js'
        return base_url + hash + '/' + file_name
    }
    function copyClipboard() {
        navigator.clipboard.writeText(document.querySelector('textarea#code_textarea').textContent);
        alert('クリップボードにコピーしました');
    }

    window.onload = async () => {
        const code_url = get_url()
        console.log('fetch: ', code_url)
        document.querySelector('textarea#code_textarea').textContent = 'javascript:' + await get_compressed_code(code_url);
    }
</script>


<h1>YT-Membership-exporter</h1>
<a href="https://github.com/oz0820/YT-Membership-exporter">Github Repository</a>
<table>
    <tbody>
    <tr>
        <td>
            <textarea id="code_textarea" style="width: 80vw;max-width: 1200px;height: 400px;"></textarea>
        </td>
    </tr>
    <tr>
        <td>
            <button onclick="copyClipboard();">Copy to Clipboard</button>
        </td>
    </tr>
    </tbody>
</table>

</body>
</html>